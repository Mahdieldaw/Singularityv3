Graph Rendering: Schema Alignment
The Mismatch
Old schema the graph expects:

TypeScript

{
  nodes: [{
    id: "opt_1",
    label: "...",
    type: "consensus" | "outlier" | "frame_challenger",
    support_count: 3,
    theme: "performance"
  }],
  edges: [{
    source: "opt_1",
    target: "opt_2",
    type: "conflicts" | "complements" | "prerequisite" | "bifurcation",
    reason: "..."
  }]
}
New schema the mapper outputs:

TypeScript

{
  claims: [{
    id: "claim_1",
    label: "...",
    text: "...",
    supporters: [1, 2, 3],
    type: "prescriptive",
    role: "anchor",
    challenges: null
  }],
  edges: [{
    from: "claim_1",
    to: "claim_2",
    type: "supports" | "conflicts" | "tradeoff" | "prerequisite"
  }]
}
Field Mapping
Old Field	New Source	Transformation
node.id	claim.id	Direct (format changed: opt_N → claim_N)
node.label	claim.label	Direct
node.type	Derived	supporters.length >= 2 ? (role === 'challenger' ? 'challenger_consensus' : 'consensus') : (role === 'challenger' ? 'frame_challenger' : 'outlier')
node.support_count	claim.supporters.length	Derived
node.theme	Removed	Not in new schema
edge.source	edge.from	Renamed
edge.target	edge.to	Renamed
edge.type	edge.type	complements → supports, bifurcation → removed
edge.reason	Removed	Not in new schema
New Graph Rendering Spec
Nodes (from claims)
TypeScript

interface GraphNode {
  id: string;                    // claim.id
  label: string;                 // claim.label
  supporterCount: number;        // claim.supporters.length
  claimType: ClaimType;          // claim.type (factual, prescriptive, etc.)
  role: ClaimRole;               // claim.role (anchor, branch, challenger, supplement)
  isConsensus: boolean;          // claim.supporters.length >= 2
  isChallenger: boolean;         // claim.role === 'challenger'
  challenges: string | null;     // claim.challenges
}
Node Sizing
Based on supporterCount:

Supporters	Size	Rationale
1	Small (base)	Singular insight
2	Medium	Minimum consensus
3	Medium-large	Solid consensus
4+	Large	Strong consensus
Formula: nodeRadius = BASE_RADIUS + (supporterCount * SCALE_FACTOR)

Node Coloring
Option A: By Role (recommended)

Role	Color	Rationale
anchor	Blue	Foundation, stable
branch	Green	Alternatives, growth
challenger	Amber/Orange	Warning, attention
supplement	Gray	Secondary, supportive
Option B: By Type

Type	Color
factual	Blue
prescriptive	Purple
conditional	Teal
contested	Red
speculative	Orange
Recommendation: Use role for primary color, type as secondary indicator (border or icon).

Node Visual States
State	Visual
Default	Role-based fill, size by supporters
Hover	Highlight + show full label + supporter count
Selected	Ring/glow + persistent label
Challenger	Distinct shape (diamond?) or icon overlay
Edges (from edges)
TypeScript

interface GraphEdge {
  source: string;    // edge.from
  target: string;    // edge.to
  type: EdgeType;    // edge.type
}
Edge Styling
Type	Style	Rationale
supports	Solid gray, arrow toward target	Reinforcement
conflicts	Red dashed, double-headed	Mutual exclusion
tradeoff	Orange dotted, double-headed	Tension but both valid
prerequisite	Solid black, arrow toward target	Dependency
Edge Thickness

Recommended: Update Graph Component
Better to update the graph component to use the new schema directly:

TypeScript

// GraphView.tsx

interface GraphViewProps {
  claims: Claim[];
  edges: Edge[];
  onNodeClick: (claimId: string) => void;
  selectedClaims: string[];
}

function GraphView({ claims, edges, onNodeClick, selectedClaims }: GraphViewProps) {
  // Build D3 nodes
  const nodes = claims.map(claim => ({
    id: claim.id,
    label: claim.label,
    radius: computeRadius(claim.supporters.length),
    color: getRoleColor(claim.role),
    isChallenger: claim.role === 'challenger',
    isSelected: selectedClaims.includes(claim.id),
    supporters: claim.supporters.length
  }));

  // Build D3 edges
  const links = edges.map(edge => ({
    source: edge.from,
    target: edge.to,
    type: edge.type,
    style: getEdgeStyle(edge.type)
  }));

  // ... D3 force simulation
}

function computeRadius(supporterCount: number): number {
  const BASE = 20;
  const SCALE = 8;
  return BASE + (supporterCount * SCALE);
}

function getRoleColor(role: ClaimRole): string {
  const colors = {
    'anchor': '#3B82F6',     // Blue
    'branch': '#10B981',     // Green
    'challenger': '#F59E0B', // Amber
    'supplement': '#6B7280'  // Gray
  };
  return colors[role];
}

function getEdgeStyle(type: EdgeType): EdgeStyle {
  const styles = {
    'supports': { stroke: '#9CA3AF', strokeDasharray: 'none', arrow: 'end' },
    'conflicts': { stroke: '#EF4444', strokeDasharray: '5,5', arrow: 'both' },
    'tradeoff': { stroke: '#F97316', strokeDasharray: '2,2', arrow: 'both' },
    'prerequisite': { stroke: '#1F2937', strokeDasharray: 'none', arrow: 'end' }
  };
  return styles[type];
}
Visual Specification
text

┌─────────────────────────────────────────────────────────────────┐
│                         GRAPH VIEW                              │
│                                                                 │
│                                                                 │
│         ●───────────────────●                                   │
│        (3)    supports     (2)                                  │
│       Anchor              Branch                                │
│       [Blue]              [Green]                               │
│         │                   │                                   │
│         │ prerequisite      │ tradeoff                          │
│         │                   │                                   │
│         ▼                   ▼                                   │
│         ◆─ ─ ─ ─ ─ ─ ─ ─ ─ ●                                   │
│        (1)    conflicts    (1)                                  │
│     Challenger           Supplement                             │
│      [Amber]              [Gray]                                │
│                                                                 │
│  Legend:                                                        │
│  ● Size = supporter count                                       │
│  ◆ Challenger (different shape)                                 │
│  ─── supports    ─ ─ conflicts                                  │
│  ─── prerequisite  ··· tradeoff                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
Interaction Spec
Action	Result
Hover node	Show tooltip: label, text preview, N supporters, type, role
Click node	Select for continuation (same as clicking anchor in narrative)
Hover edge	Show tooltip: {source.label} {type} {target.label}
Click edge	Highlight both connected nodes
Click background	Deselect all
Summary for IDE Agent
text

## Graph Component Update

The graph component needs to be updated to render from the new MapperArtifact schema.

### Schema Changes

Old: Separate graph_topology with nodes[] and edges[]
New: Unified map with claims[] and edges[]

### Field Mapping

Nodes:
- id: claim.id (format: "claim_N" not "opt_N")
- label: claim.label
- size: derived from claim.supporters.length
- color: derived from claim.role (anchor=blue, branch=green, challenger=amber, supplement=gray)
- shape: challenger gets distinct shape (diamond), others circle

Edges:
- source: edge.from (renamed from edge.source)
- target: edge.to (renamed from edge.target)  
- type: edge.type (supports replaces complements, bifurcation removed)
- style: derived from type (supports=solid gray, conflicts=red dashed, tradeoff=orange dotted, prerequisite=solid black)

### Removed Fields

- node.theme: No longer exists
- node.type ("consensus"|"outlier"|"frame_challenger"): Derive from supporters.length and role
- node.support_count: Derive from supporters.length
- edge.reason: No longer exists

### Implementation Options

Option 1: Add transformation layer that converts new schema to old format
Option 2: Update graph component to read new schema directly (recommended)

### Interaction

- Clicking a node should trigger the same action as clicking an anchor in the narrative
- Selected nodes should be visually highlighted
- Hovering shows claim details as tooltip